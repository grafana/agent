server:
  log_level: ${GRAFANA_AGENT_LOG_LEVEL:-info}

integrations:

metrics:
  wal_directory: /tmp/grafana-agent-wal
  global:
    external_labels:
      cluster: docker-compose
      source: agent
    scrape_interval: 30s
  configs:
    - name: default
      remote_write:
        - url: http://mimir:8080/api/v1/push
          send_exemplars: true
      scrape_configs:

logs:
  configs:
    - name: default
      positions:
        filename: /tmp/positions.yaml
      scrape_configs:
        - job_name: integrations/mysql
          static_configs:
            - labels:
                instance: grafana-mysql-db
                job: integrations/mysql
                __path__: /var/log/mysql/error-log.log #/var/log/mysql/*.log
          pipeline_stages:
            - regex:
                expression: '(?P<timestamp>.+) (?P<thread>[\d]+) \[(?P<label>.+?)\]( \[(?P<err_code>.+?)\] \[(?P<subsystem>.+?)\])? (?P<msg>.+)'
            - labels:
                label:
                err_code:
                subsystem:
            - drop:
                expression: "^ *$"
                drop_counter_reason: "drop empty lines"
      clients:
        - url: http://loki:3100/loki/api/v1/push
          external_labels:
            cluster: docker-compose
            source: agent
